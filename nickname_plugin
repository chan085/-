package org.example.test.nicknameplugin;

import org.bukkit.ChatColor;
import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.command.CommandExecutor;
import org.bukkit.entity.Player;
import org.bukkit.plugin.java.JavaPlugin;

public class NicknamePlugin extends JavaPlugin implements CommandExecutor {

    @Override
    public void onEnable() {
        getCommand("nick").setExecutor(this);
        getCommand("delnick").setExecutor(this);
        getCommand("nickcolor").setExecutor(this);
    }

    @Override
    public boolean onCommand(CommandSender sender, Command command, String label, String[] args) {
        if (!(sender instanceof Player)) {
            sender.sendMessage("이 명령어는 플레이어만 사용할 수 있습니다.");
            return true;
        }

        Player player = (Player) sender;

        if (command.getName().equalsIgnoreCase("nick")) {
            if (args.length != 2) {
                player.sendMessage(ChatColor.RED + "사용법: /nick <원래닉네임> <바꿀닉네임>");
                return true;
            }

            String originalName = args[0];
            String newName = ChatColor.translateAlternateColorCodes('&', args[1]);

            if (!player.getName().equals(originalName)) {
                player.sendMessage(ChatColor.RED + "현재 닉네임이 입력한 원래 닉네임과 일치하지 않습니다.");
                return true;
            }

            player.setDisplayName(newName);
            player.sendMessage(ChatColor.GREEN + "닉네임이 변경되었습니다.");
        } else if (command.getName().equalsIgnoreCase("delnick")) {
            player.setDisplayName(player.getName());
            player.sendMessage(ChatColor.GREEN + "닉네임이 삭제되었습니다.");
        } else if (command.getName().equalsIgnoreCase("nickcolor")) {
            if (args.length != 1) {
                player.sendMessage(ChatColor.RED + "사용법: /nickcolor <색깔코드>");
                return true;
            }

            String colorCode = args[0];
            if (!colorCode.matches("[a-fA-F0-9]")) {
                player.sendMessage(ChatColor.RED + "잘못된 색깔 코드입니다. 유효한 색깔 코드를 입력하세요.");
                return true;
            }

            String currentName = player.getDisplayName();
            String newName = ChatColor.translateAlternateColorCodes('&', "&" + colorCode + currentName);

            player.setDisplayName(newName);
            player.sendMessage(ChatColor.GREEN + "닉네임 색상이 변경되었습니다.");
        }

        return true;
    }
